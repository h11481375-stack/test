<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zoe DIY Studio | é£ä¹¦æé€Ÿç‰ˆ</title>
    <style>
        :root { --primary-pink: #ffafbd; --accent-pink: #ff8e9a; --bg: #ffffff; --bubble-user: #ffe4e8; --text: #4a4a4a; }
        body, html { height: 100%; margin: 0; font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); }
        #main-container { display: flex; flex-direction: column; height: 100vh; max-width: 800px; margin: 0 auto; box-shadow: 0 0 15px rgba(0,0,0,0.05); }
        header { padding: 15px; text-align: center; border-bottom: 1px solid #fdf2f4; cursor: pointer; }
        header h1 { margin: 0; font-size: 1.2rem; color: var(--accent-pink); letter-spacing: 2px; }
        #config-panel { display: none; background: #fff5f6; padding: 20px; border-bottom: 1px solid #ffe4e8; }
        #config-panel input { padding: 10px; margin: 5px 0; border: 1px solid #ffafbd; border-radius: 20px; width: 100%; box-sizing: border-box; }
        .save-btn { background: var(--accent-pink); color: white; border: none; padding: 10px; border-radius: 20px; cursor: pointer; width: 100%; margin-top: 10px; }
        #chat-box { flex: 1; overflow-y: auto; padding: 20px; }
        .row { display: flex; margin-bottom: 20px; }
        .ai-row { justify-content: flex-start; }
        .user-row { justify-content: flex-end; }
        .bubble { max-width: 75%; padding: 12px 18px; border-radius: 20px; font-size: 15px; }
        .user-bubble { background: var(--bubble-user); color: #d63384; }
        .ai-bubble { background: #f9f9f9; border: 1px solid #eee; }
        .input-area { padding: 20px; border-top: 1px solid #f8f8f8; display: flex; gap: 10px; }
        .input-wrapper { flex: 1; display: flex; border: 2px solid #ffe4e8; border-radius: 30px; padding: 5px 15px; }
        input[type="text"] { flex: 1; border: none; outline: none; padding: 10px; font-size: 16px; }
        .btn { background: none; border: none; cursor: pointer; color: var(--primary-pink); font-size: 24px; }
    </style>
</head>
<body>

<div id="main-container">
    <header onclick="toggleConfig()">
        <h1>ZOE DIY STUDIO ğŸŒ¸</h1>
        <small id="status" style="color:#ccc;">ç‚¹å‡»æ­¤å¤„é…ç½®</small>
    </header>

    <div id="config-panel">
        <input type="password" id="apiKey" placeholder="æ™ºè°± AI API Key">
        <input type="text" id="feishuUrl" placeholder="é£ä¹¦åˆ†äº«é“¾æ¥ (https://...)">
        <button class="save-btn" onclick="saveConfig()">ä¿å­˜å¹¶å¼€å¯å¯¹è¯</button>
    </div>

    <div id="chat-box">
        <div class="row ai-row"><div class="bubble ai-bubble">ä½ å¥½ï¼é…ç½®å¥½ AI Key å’Œé£ä¹¦åˆ†äº«é“¾æ¥åï¼Œæˆ‘å°±å¯ä»¥å¸®ä½ æŸ¥ 1400 è¡Œåº“å­˜å•¦ï¼âœ¨</div></div>
    </div>

    <div class="input-area">
        <div class="input-wrapper">
            <input type="text" id="userInput" placeholder="è¾“å…¥ SKU æˆ–åç§°...">
            <button class="btn" onclick="handleSend()">ğŸ’–</button>
        </div>
    </div>
</div>

<script>
    function toggleConfig() {
        const p = document.getElementById('config-panel');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
        document.getElementById('apiKey').value = localStorage.getItem('zhipu_key') || '';
        document.getElementById('feishuUrl').value = localStorage.getItem('feishu_share_url') || '';
    }

    function saveConfig() {
        localStorage.setItem('zhipu_key', document.getElementById('apiKey').value);
        localStorage.setItem('feishu_share_url', document.getElementById('feishuUrl').value);
        alert("é…ç½®å·²é”å®šï¼Zoe å‡†å¤‡å°±ç»ªã€‚ğŸŒ¸");
        toggleConfig();
    }

    async function handleSend() {
        const input = document.getElementById('userInput');
        const text = input.value.trim();
        const apiKey = localStorage.getItem('zhipu_key');
        const shareUrl = localStorage.getItem('feishu_share_url');
        
        if(!apiKey || !shareUrl) { alert("è¯·å…ˆé…ç½® Key å’Œé“¾æ¥å–”ï¼"); toggleConfig(); return; }
        if(!text) return;

        addMsg(text, 'user');
        input.value = '';
        const aiBubble = addMsg("Zoe æ­£åœ¨äº‘ç«¯åŒæ­¥é£ä¹¦æ•°æ®...", 'ai');

        try {
            const response = await fetch("https://open.bigmodel.cn/api/paas/v4/chat/completions", {
                method: "POST",
                headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
                body: JSON.stringify({
                    model: "glm-4",
                    messages: [
                        { role: "system", content: `ä½ æ˜¯Zoeã€‚ä½ ç°åœ¨è¿æ¥äº†é£ä¹¦è¡¨æ ¼ï¼š${shareUrl}ã€‚è¯·åŸºäºè¯¥è¡¨æ ¼å›ç­”åº“å­˜ã€‚å¦‚æœæ•°æ®åŠ è½½æ…¢ï¼Œè¯·è®©ç”¨æˆ·ç¨ç­‰ã€‚ä½¿ç”¨ç”œç¾å£°éŸ³ã€‚` },
                        { role: "user", content: text }
                    ]
                })
            });
            const data = await response.json();
            const reply = data.choices[0].message.content;
            aiBubble.innerText = reply;
            
            // è¯­éŸ³
            const msg = new SpeechSynthesisUtterance(reply);
            msg.pitch = 1.3;
            window.speechSynthesis.speak(msg);
        } catch (e) { aiBubble.innerText = "å‡ºé”™äº†ï¼Œè¯·æ£€æŸ¥é…ç½®ã€‚"; }
    }

    function addMsg(text, role) {
        const row = document.createElement('div');
        row.className = `row ${role}-row`;
        row.innerHTML = `<div class="bubble ${role}-bubble">${text}</div>`;
        document.getElementById('chat-box').appendChild(row);
        document.getElementById('chat-box').scrollTop = document.getElementById('chat-box').scrollHeight;
        return row.lastChild;
    }
</script>
</body>
</html>
