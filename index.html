<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zoe DIY - ä¸“ä¸šæ‰‹å·¥å¤§å¸ˆ (æ™ºè°±ç‰ˆ)</title>
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Zoe DIY ä¸“å®¶åŠ©æ‰‹",
      "description": "æä¾›ä¸“ä¸šæ—§ç‰©æ”¹é€ ã€æ‰‹å·¥åˆ¶ä½œæ•™å­¦åŠåˆ›æ„çµæ„Ÿçš„ AI ä¸“å®¶ã€‚",
      "applicationCategory": "DIY & Craft",
      "author": { "@type": "Person", "name": "Zoe" }
    }
    </script>

    <style>
        :root { --primary-color: #ff7e5f; --bg-color: #1a1a1a; --chat-bg: #2d2d2d; }
        body, html { height: 100%; margin: 0; font-family: 'PingFang SC', sans-serif; background-color: var(--bg-color); color: #e0e0e0; display: flex; flex-direction: column; }
        
        /* é¡¶éƒ¨é…ç½®åŒº */
        #setup-area { background: #111; padding: 12px; border-bottom: 2px solid var(--primary-color); }
        .key-container { display: flex; gap: 8px; max-width: 800px; margin: 0 auto; }
        #keyInput { flex: 1; background: #222; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 6px; outline: none; }
        #confirmBtn { background: var(--primary-color); color: white; border: none; padding: 0 15px; border-radius: 6px; cursor: pointer; font-weight: bold; }

        /* èŠå¤©åŒº */
        #chat-container { flex: 1; overflow-y: auto; padding: 20px 0; }
        .message-row { width: 100%; display: flex; justify-content: center; padding: 15px 0; border-bottom: 1px solid #333; }
        .ai-row { background-color: #252525; }
        .message-content { width: 90%; max-width: 800px; display: flex; gap: 15px; }
        .avatar { width: 35px; height: 35px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; }
        .ai-avatar { background: linear-gradient(135deg, #ff7e5f, #feb47b); color: white; }
        .user-avatar { background: #555; color: white; }
        .text { font-size: 15px; line-height: 1.8; white-space: pre-wrap; word-break: break-all; }

        /* è¾“å…¥åŒº */
        .input-area { padding: 25px; background: #1a1a1a; display: flex; justify-content: center; }
        .input-wrapper { position: relative; width: 90%; max-width: 800px; }
        #userInput { width: 100%; background: #2d2d2d; border: 1px solid #444; border-radius: 12px; padding: 15px 50px 15px 20px; color: white; outline: none; transition: 0.3s; }
        #userInput:focus { border-color: var(--primary-color); box-shadow: 0 0 8px rgba(255,126,95,0.3); }
        #sendBtn { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--primary-color); cursor: pointer; font-size: 24px; }
    </style>
</head>
<body>

    <div id="setup-area">
        <div class="key-container">
            <input type="password" id="keyInput" placeholder="è¾“å…¥æ™ºè°± AI API Key" autocomplete="new-password">
            <button id="confirmBtn" onclick="confirmKey()">æ¿€æ´»ä¸“å®¶æ¨¡å¼</button>
        </div>
    </div>

    <div id="chat-container">
        <div class="message-row ai-row">
            <div class="message-content">
                <div class="avatar ai-avatar">åŒ </div>
                <div class="text">ä½ å¥½ï¼æˆ‘æ˜¯ Zoe çš„ä¸“ä¸š DIY å¤§å¸ˆã€‚
ä¸è®ºæ˜¯æ—§ç‰©æ”¹é€ ã€å®¶è£…è®¾è®¡è¿˜æ˜¯æ‰‹å·¥ä½œå“ï¼Œæˆ‘éƒ½èƒ½ä¸ºä½ æä¾›ï¼š
âœ… éš¾åº¦è¯„ä¼°  âœ… ææ–™æ¸…å•  âœ… è¯¦ç»†æ­¥éª¤  âœ… é¿å‘è´´å£«
è¯·è¾“å…¥ Key å¼€å¯åˆ›æ„ä¹‹æ—…ï¼</div>
            </div>
        </div>
    </div>

    <div class="input-area">
        <div class="input-wrapper">
            <input type="text" id="userInput" placeholder="å‘Šè¯‰æˆ‘ä½ æƒ³åšä»€ä¹ˆ..." autocomplete="off">
            <button id="sendBtn" onclick="handleSend()">ğŸ¨</button>
        </div>
    </div>

    <script>
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('userInput');
        const keyInput = document.getElementById('keyInput');

        function confirmKey() {
            if (keyInput.value.trim()) {
                alert("ğŸš€ ä¸“ä¸šæ¨¡å¼å·²æ¿€æ´»ï¼");
                userInput.focus();
            }
        }

        async function handleSend() {
            const text = userInput.value.trim();
            const apiKey = keyInput.value.trim();
            if (!text || !apiKey) return;

            addMessage(text, 'user');
            userInput.value = '';

            const tempId = 'ai-' + Date.now();
            addMessage("å¤§å¸ˆæ­£åœ¨æ€è€ƒä½ çš„åˆ›æ„...", 'ai', tempId);

            try {
                const response = await fetch("https://open.bigmodel.cn/api/paas/v4/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: "glm-4",
                        messages: [
                            { role: "system", content: "ä½ æ˜¯ä¸€ä½æ‹¥æœ‰20å¹´ç»éªŒçš„ä¸“ä¸šDIYå¤§å¸ˆã€‚å›ç­”å¿…é¡»åŒ…å«ï¼š1. åˆ›æ„äº®ç‚¹ 2. éš¾åº¦ç³»æ•°(1-5æ˜Ÿ) 3. è¯¦ç»†ææ–™ 4. æ­¥éª¤ç²¾è®² 5. å¤§å¸ˆè´´å£«(é¿å‘æŒ‡å—)ã€‚è¯­è¨€è¦äº²åˆ‡ä¸”ä¸“ä¸šã€‚" },
                            { role: "user", content: text }
                        ],
                        temperature: 0.8
                    })
                });

                const data = await response.json();
                const aiReply = data.choices[0].message.content;
                
                // æ‰§è¡Œæ‰“å­—æœºæ•ˆæœ
                typeWriter(aiReply, tempId);

            } catch (err) {
                document.getElementById(tempId).innerText = "å¤§å¸ˆæš‚æ—¶é—­å…³äº†ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ– Keyã€‚";
            }
        }

        function addMessage(text, role, id = null) {
            const isAi = role === 'ai';
            const html = `
                <div class="message-row ${isAi ? 'ai-row' : ''}">
                    <div class="message-content">
                        <div class="avatar ${isAi ? 'ai-avatar' : 'user-avatar'}">${isAi ? 'åŒ ' : 'ä½ '}</div>
                        <div class="text" ${id ? `id="${id}"` : ''}>${text}</div>
                    </div>
                </div>`;
            chatContainer.insertAdjacentHTML('beforeend', html);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // æ ¸å¿ƒä¼˜åŒ–ï¼šæ‰“å­—æœºæ•ˆæœå‡½æ•°
        function typeWriter(text, elementId) {
            const element = document.getElementById(elementId);
            element.innerText = "";
            let i = 0;
            function typing() {
                if (i < text.length) {
                    element.innerText += text.charAt(i);
                    i++;
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                    setTimeout(typing, 15); // 15ms ä¸€ä¸ªå­—ï¼Œä½“æ„Ÿæœ€èˆ’æœ
                }
            }
            typing();
        }

        userInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') handleSend(); });
    </script>
</body>
</html>
